<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INSY √úbung 02 - Pr√ºfungsvorbereitung Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .progress-container {
            background: #f0f0f0;
            padding: 20px 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            background: white;
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .quiz-content {
            padding: 30px;
        }

        .category-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .category-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .category-btn.active {
            background: #667eea;
            color: white;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-number {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .category-tag {
            background: #764ba2;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .question-text {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Stil f√ºr Multiple-Choice Optionen */
        .option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .option:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .option-letter {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .option.correct .option-letter {
            background: #28a745;
        }

        .option.wrong {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .option.wrong .option-letter {
            background: #dc3545;
        }
        
        /* Checkbox-Stil f√ºr MC-Fragen mit Mehrfachauswahl */
        .option-checkbox {
            position: absolute;
            right: 20px;
            width: 25px;
            height: 25px;
        }

        /* Stil f√ºr L√ºckentext-Antworten */
        .fill-in-the-blank-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .fill-in-the-blank-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-size: 1.1em;
            transition: border-color 0.3s;
        }

        .fill-in-the-blank-input:focus {
            border-color: #667eea;
            outline: none;
        }

        .fill-in-the-blank-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fill-in-the-blank-label {
            font-weight: bold;
            color: #333;
            min-width: 120px;
        }

        .answer-section {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .answer-section.show {
            display: block;
        }

        .answer-section.hide {
            display: none;
        }

        .answer-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .answer-text {
            color: #333;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .result-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
        }

        .result-summary h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .result-score {
            font-size: 4em;
            font-weight: bold;
            margin: 20px 0;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .result-detail {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 12px;
        }

        .result-detail-value {
            font-size: 2em;
            font-weight: bold;
            margin-top: 10px;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 2px solid #e0e0e0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }

            .question-text {
                font-size: 1.1em;
            }

            .btn {
                min-width: 100%;
            }

            .result-score {
                font-size: 3em;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Visuelle Korrektur f√ºr Richtig/Falsch-Felder */
        .fill-in-the-blank-input.correct-answer {
            border-color: #28a745;
            background-color: #d4edda;
        }

        .fill-in-the-blank-input.wrong-answer {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì INSY √úbung 02 - Pr√ºfungsvorbereitung</h1>
            <p>Betriebssysteme, Cloud, Linux-Grundlagen</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Fortschritt</div>
                    <div class="stat-value" id="progressText">0/60</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Richtig</div>
                    <div class="stat-value" id="correctCount" style="color: #28a745;">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Falsch</div>
                    <div class="stat-value" id="wrongCount" style="color: #dc3545;">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Erfolgsrate</div>
                    <div class="stat-value" id="successRate">0%</div>
                </div>
            </div>
        </div>

        <div class="quiz-content">
            <div class="category-selector" id="categorySelector">
                </div>

            <div id="quizContainer"></div>

            <div class="button-group">
                <button class="btn btn-secondary" id="prevBtn" style="display: none;">‚¨ÖÔ∏è Vorherige Frage</button>
                <button class="btn btn-primary" id="nextBtn">N√§chste Frage ‚û°Ô∏è</button>
                <button class="btn btn-success" id="finishBtn" style="display: none;">‚úÖ Quiz Beenden</button>
                <button class="btn btn-primary" id="checkAnswerBtn">Antwort √úberpr√ºfen ‚úîÔ∏è</button>
            </div>
        </div>

        <div class="footer">
            <p>üí° Tipp: Die MC-Fragen (Mehrfachauswahl) erlauben das gleichzeitige Anklicken mehrerer Optionen.</p>
            <p style="margin-top: 10px;">FHNW - Hochschule f√ºr Informatik | INSY 2025</p>
        </div>
    </div>

    <script>
        // Fragen-Datenbank
        // SC = Single Choice (nur 1 richtige Antwort), MC = Multiple Choice (mehrere richtige Antworten m√∂glich),
        // RF = Richtig/Falsch (wird als SC mit Optionen Richtig/Falsch implementiert),
        // FTB = Fill-in-the-Blank (L√ºckentext)
        const questionsData = [
            // TEIL A - Auswahlaufgaben (SC/MC)
            { type: 'SC', id: 1, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Was ist die prim√§re Aufgabe des Kernels?', options: ['Benutzeroberfl√§che bereitstellen', 'Hardware verwalten und Ressourcen zuteilen', 'Pakete installieren', 'Logs rotieren'], correct: 1, explanation: 'Der Kernel (engl. Kern) ist die zentrale Komponente eines OS und verwaltet die Hardware und teilt die Ressourcen an die Prozesse zu.' },
            { type: 'SC', id: 2, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Ein Betriebssystem ist ‚Äûunsichtbar‚Äú, wenn ‚Ä¶', options: ['es keinen Kernel hat', 'es als Embedded OS in Ger√§ten l√§uft', 'es nur im RAM liegt', 'es keinen Bootloader braucht'], correct: 1, explanation: 'Als Embedded OS (z.B. in IoT-Ger√§ten) ist das OS tief im Ger√§t integriert und f√ºr den Nutzenden nicht direkt als OS erkennbar ("unsichtbar").' },
            { type: 'MC', id: 3, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Komponenten eines OS laut Notiz?', options: ['Kernel', 'Bootloader', 'Treiber/Dienste/Bibliotheken', 'Browser', 'Tools/Apps'], correct: [0, 1, 2, 4], explanation: 'Alle ausser der Browser sind wesentliche Komponenten eines Betriebssystems. (A: Kernel, B: Bootloader, C: Treiber, D: Tools/Apps).' },
            { type: 'SC', id: 4, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Ziel der OS-Abstraktion ist v. a. ‚Ä¶', options: ['Hardware maximal auslasten', 'Komplexit√§t der Hardware vor Nutzenden verstecken', 'GUI schneller starten', 'Logs minimieren'], correct: 1, explanation: 'Die Abstraktion des Betriebssystems verbirgt die Komplexit√§t der Hardware vor Anwendungen und Nutzenden und bietet eine standardisierte Schnittstelle (API).' },
            { type: 'SC', id: 5, category: 'paket-management', categoryName: 'Paket-Management (APT)', question: 'APT: apt update bedeutet ‚Ä¶', options: ['Pakete upgraden', 'Paketlisten aktualisieren', 'nicht ben√∂tigte Pakete entfernen', 'Distribution upgraden'], correct: 1, explanation: 'apt update aktualisiert nur die *Liste* der verf√ºgbaren Pakete, nicht die installierten Programme selbst.' },
            { type: 'SC', id: 6, category: 'paket-management', categoryName: 'Paket-Management (APT)', question: 'APT: Welcher Befehl darf Abh√§ngigkeiten entfernen/hinzuf√ºgen?', options: ['apt upgrade', 'apt full-upgrade (oder dist-upgrade)', 'apt search', 'apt show'], correct: 1, explanation: 'apt upgrade f√ºhrt nur ein einfaches Upgrade durch, w√§hrend apt full-upgrade (oder dist-upgrade) auch Abh√§ngigkeiten entfernen/hinzuf√ºgen darf, was f√ºr ein gr√∂√üeres Upgrade (Distributions-Upgrade) notwendig ist.' },
            { type: 'SC', id: 7, category: 'paket-management', categoryName: 'Paket-Management (APT)', question: 'Debian-Upgrade: Nach dem √Ñndern von bookworm ‚Üí trixie in den Sources folgt ‚Ä¶', options: ['apt upgrade', 'apt update und dann apt full-upgrade', 'direkter Reboot', 'apt purge'], correct: 1, explanation: 'Nach dem √Ñndern der Quellen muss zuerst die Paketliste (apt update) und dann die gesamte Distribution (apt full-upgrade/dist-upgrade) aktualisiert werden.' },
            { type: 'MC', id: 8, category: 'filesystem-cli', categoryName: 'Dateisystem & CLI', question: 'Dateiansicht: Welche Befehle zeigen Inhalt (nicht nur Namen)?', options: ['ls -la', 'cat', 'less', 'head', 'pwd'], correct: [1, 2, 3], explanation: 'ls -la zeigt nur Dateinamen und Metadaten. pwd zeigt den aktuellen Pfad. cat, less, und head zeigen den Inhalt einer Datei.' },
            { type: 'SC', id: 9, category: 'filesystem-cli', categoryName: 'Dateisystem & CLI', question: 'df vs. du ‚Äì warum ist du i. d. R. langsamer?', options: ['Nutzt Netzwerk', 'Liest Superblock', 'Traversiert Dateib√§ume/Metadaten aller Dateien', 'Hat h√∂here Priorit√§t'], correct: 2, explanation: 'df liest nur den Superblock pro Dateisystem (sehr schnell). du muss jeden einzelnen Dateibaum rekursiv durchlaufen (langsamer).' },
            { type: 'SC', id: 10, category: 'ssh-security', categoryName: 'SSH & Sicherheit', question: 'SSH-Sicherheit: Pflichtrechte f√ºr privaten Schl√ºssel?', options: ['400', '600', '644', '700'], correct: 1, explanation: '600 bedeutet rw-------, also nur der Eigent√ºmer darf lesen und schreiben. Dies ist die sicherste Einstellung f√ºr private Schl√ºssel, da SSH diese bei offeneren Rechten verweigert.' },
            { type: 'SC', id: 11, category: 'cloud-basics', categoryName: 'Cloud & Switch Engines', question: 'Cloud/Switch Engines: Standard bei Security Groups?', options: ['Alles erlaubt', 'Nur ausgehend erlaubt', 'Alles blockiert, Regeln explizit setzen', 'Nur Port 22 offen'], correct: 2, explanation: 'Standardm√§√üig sind Security Groups restriktiv (alles blockiert). Zug√§nge m√ºssen explizit erlaubt werden (Security-by-Default).' },
            { type: 'SC', id: 12, category: 'cloud-basics', categoryName: 'Cloud & Switch Engines', question: 'Floating IP ist ‚Ä¶', options: ['interne RFC1918-Adresse', '√∂ffentliche, zwischen VMs verschiebbare IP', 'DHCP-Lease', 'IPv6-Link-Local'], correct: 1, explanation: 'Eine Floating IP ist eine √∂ffentlich routbare IP-Adresse, die von der Cloud-Plattform bereitgestellt und einer VM zugewiesen/entzogen werden kann.' },
            { type: 'SC', id: 13, category: 'cloud-basics', categoryName: 'Cloud & Switch Engines', question: 'Flavor beschreibt ‚Ä¶', options: ['OS-Version', 'Kernel-Patchlevel', 'vCPU/RAM/Disk-Gr√∂√üe einer VM', 'Paketquelle'], correct: 2, explanation: 'Das Flavor definiert die Gr√∂√üe und Ressourcen (vCPUs, RAM, Festplattengr√∂√üe) einer VM-Instanz in der Cloud.' },
            { type: 'SC', id: 14, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Debian-Status aus Notiz (Stand deiner Unterlagen):', options: ['Bookworm: Stable, Trixie: Testing', 'Bookworm: Oldstable, Trixie: Stable', 'Bookworm: EOL, Trixie: Oldstable', 'Beide Stable'], correct: 1, explanation: 'Trixie (13) ist Stable geworden (oder wird es bald), Bookworm (12) ist somit Oldstable.' },
            { type: 'SC', id: 15, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Kernel 5.6+ ist relevant f√ºr ‚Ä¶', options: ['cgroups v2', 'WireGuard im Kernel', 'Wayland', 'UnionFS'], correct: 1, explanation: 'WireGuard (VPN-L√∂sung) wurde ab Kernel 5.6 in den Hauptzweig integriert.' },
            { type: 'SC', id: 16, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'WSL 2 bringt ‚Ä¶', options: ['POSIX-Emulation ohne Kernel', 'echten Linux-Kernel via Hyper-V', 'reines Cygwin', 'Docker-Daemon im Userspace'], correct: 1, explanation: 'WSL 2 nutzt Hyper-V, um einen echten Linux-Kernel auszuf√ºhren. WSL 1 war eine reine Systemaufruf-√úbersetzungsschicht.' },
            { type: 'MC', id: 17, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'systemd ist PID 1 und ‚Ä¶', options: ['startet/verwaltet Dienste', 'ersetzt Bootloader', 'arbeitet mit Targets statt Runlevels', 'kann Timer (ersetzt viele Cron-F√§lle)', 'ist auf BSD Standard'], correct: [0, 2, 3], explanation: 'systemd ist der Init-Prozess (PID 1), startet Dienste, nutzt Targets anstelle von Runlevels und verwaltet Timer. Es ist nicht auf BSD Standard.' },
            { type: 'SC', id: 18, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'Boot-Reihenfolge (vereinfacht, Start ‚Üí Login):', options: ['Bootloader ‚Üí Firmware ‚Üí Kernel ‚Üí systemd', 'Firmware ‚Üí Bootloader ‚Üí Kernel+initramfs ‚Üí systemd', 'Firmware ‚Üí Kernel ‚Üí Bootloader ‚Üí systemd', 'Kernel ‚Üí Firmware ‚Üí Bootloader ‚Üí systemd'], correct: 1, explanation: 'Die Firmware (BIOS/UEFI) startet den Bootloader (z.B. GRUB), dieser l√§dt Kernel und initramfs, und der Kernel startet systemd (PID 1).' },
            { type: 'SC', id: 19, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'initramfs dient ‚Ä¶', options: ['GUI-Treiber laden', 'tempor√§res Root im RAM, fr√ºhe Treiber & Mount', 'Logrotation beim Boot', 'Timesync'], correct: 1, explanation: 'Die initial ramdisk (initramfs) ist ein kleines, tempor√§res Root-Dateisystem, um fr√ºh im Boot-Prozess notwendige Treiber (z.B. f√ºr Festplatten) zu laden.' },
            { type: 'SC', id: 20, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'systemctl isolate multi-user.target ‚Ä¶', options: ['f√§hrt herunter', 'wechselt in Mehrbenutzer ohne GUI', 'aktiviert Autologin', 'l√∂scht Dienste'], correct: 1, explanation: 'multi-user.target ist der Zustand ohne grafische Oberfl√§che. isolate wechselt den Systemzustand auf dieses Target.' },
            { type: 'SC', id: 21, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'Richtige Zuordnung: graphical.target ‚âà Runlevel ‚Ä¶', options: ['1', '3', '5', '6'], correct: 2, explanation: 'graphical.target entspricht dem alten Runlevel 5 (Vollst√§ndiger Multi-User-Modus mit GUI).' },
            { type: 'MC', id: 22, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Prozesszust√§nde ‚Äì w√§hle korrekte Paare:', options: ['R = running/runnable', 'S = Interruptible Sleep', 'D = Uninterruptible Sleep (I/O-Wait)', 'Z = Zombie', 'T = Stopped'], correct: [0, 1, 2, 3, 4], explanation: 'Alle genannten Prozesszust√§nde und ihre Abk√ºrzungen sind korrekt.' },
            { type: 'SC', id: 23, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Signals: ‚Äûsauber beenden‚Äú ist standardm√§√üig ‚Ä¶', options: ['SIGINT (2)', 'SIGTERM (15)', 'SIGKILL (9)', 'SIGHUP (1)'], correct: 1, explanation: 'SIGTERM (15) ist das "sanfte" Beenden, bei dem der Prozess seine Arbeit sauber abschlie√üen kann. SIGKILL (9) ist das erzwungene Beenden.' },
            { type: 'MC', id: 24, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Kernel-Module ‚Äì richtige Aussagen:', options: ['lsmod listet geladene Module', 'modprobe l√§dt inkl. Abh√§ngigkeiten', 'insmod ist moderner als modprobe', 'Module liegen unter /lib/modules/$(uname -r)/', 'depmod -a erstellt Abh√§ngigkeitslisten'], correct: [0, 1, 3, 4], explanation: 'insmod ist √§lter, modprobe ist moderner und kann Abh√§ngigkeiten aufl√∂sen. Die anderen Aussagen sind korrekt.' },
            { type: 'SC', id: 25, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'Zeit & NTP: Aktivierung via systemd erfolgt durch ‚Ä¶', options: ['timedatectl set-ntp true', 'ntpdate now', 'hwclock --sync', 'date -s now'], correct: 0, explanation: 'timedatectl ist das systemd-Tool zur Konfiguration der Systemzeit, einschliesslich der NTP-Synchronisation.' },
            { type: 'SC', id: 26, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'systemd-analyze blame zeigt ‚Ä¶', options: ['CPU-Last pro Dienst', 'Boot-Dauer pro Dienst', 'Abh√§ngigkeiten', 'Speicherverbrauch'], correct: 1, explanation: 'systemd-analyze blame listet die ben√∂tigte Boot-Zeit f√ºr jeden Dienst auf und hilft bei der Optimierung der Startgeschwindigkeit.' },
            { type: 'MC', id: 27, category: 'filesystem-cli', categoryName: 'Dateisystem & CLI', question: 'FHS ‚Äì richtige Paare:', options: ['/etc ‚Äì Konfigurationsdateien', '/var ‚Äì variable Daten/Logs', '/usr ‚Äì Nutzer-Homes', '/dev ‚Äì Ger√§tedateien', '/bin ‚Äì essenzielle Programme'], correct: [0, 1, 3, 4], explanation: '/usr enth√§lt binaries/libraries. Nutzer-Homes sind in der Regel unter /home.' },
            { type: 'SC', id: 28, category: 'user-rights', categoryName: 'User-Rechte & Links', question: 'Inodes enthalten nicht ‚Ä¶', options: ['Dateigr√∂√üe & Zeiten', 'Rechte & Owner', 'Dateiname', 'Block-Pointer'], correct: 2, explanation: 'Der Dateiname ist in den Verzeichniseintr√§gen gespeichert. Die Inode (Index Node) enth√§lt alle Metadaten der Datei ausser dem Namen.' },
            { type: 'SC', id: 29, category: 'user-rights', categoryName: 'User-Rechte & Links', question: 'Hardlink ‚Äì welche Aussage stimmt?', options: ['Eigene Inode, kann √ºber Partitionen', 'Gleiche Inode wie Original, gleiche Partition', 'Kann auf Verzeichnisse systemweit', 'Bricht beim Verschieben der Zieldatei immer'], correct: 1, explanation: 'Hardlinks zeigen auf dieselbe Inode (Metadaten-Struktur) wie das Original. Sie sind auf dasselbe Dateisystem beschr√§nkt und k√∂nnen nicht auf Verzeichnisse gesetzt werden.' },
            { type: 'MC', id: 30, category: 'user-rights', categoryName: 'User-Rechte & Links', question: 'Sonderbits korrekt zugeordnet:', options: ['SUID = u+s = 4xxx', 'SGID = g+s = 2xxx', 'Sticky = +t = 1xxx', 'SGID auf Verzeichnis: neue Dateien erben Gruppe', 'Sticky: jeder kann alles l√∂schen'], correct: [0, 1, 2, 3], explanation: 'Das Sticky-Bit verhindert, dass Benutzer Dateien anderer im gemeinsamen Verzeichnis l√∂schen k√∂nnen. Das Gegenteil von E ist richtig.' },
            { type: 'SC', id: 31, category: 'user-rights', categoryName: 'User-Rechte & Links', question: 'umask 0022 f√ºhrt bei neuen Dateien typ. zu ‚Ä¶', options: ['666', '644', '600', '755'], correct: 1, explanation: 'F√ºr Dateien (Start 666): 666 - 022 = 644 (rw-r--r--). F√ºr Verzeichnisse (Start 777): 777 - 022 = 755 (rwxr-xr-x).' },
            { type: 'MC', id: 32, category: 'filesystem-cli', categoryName: 'Dateisystem & CLI', question: 'find ‚Äì passende Beispiele:', options: ['find / -type f -size +10M', 'find /data -mtime -7', 'find /var -user root', 'find / -perm 644', 'find -iname ohne Pfad ist g√ºltig'], correct: [0, 1, 2, 3], explanation: 'find ben√∂tigt immer einen Startpfad (z.B. . oder /) und keine der Aussagen ist ein Beispiel daf√ºr, dass find -iname ohne Pfad g√ºltig ist, was es auch nicht ist.' },
            { type: 'SC', id: 33, category: 'filesystem-cli', categoryName: 'Dateisystem & CLI', question: 'grep rekursiv & case-insensitive:', options: ['grep -R "Text" .', 'grep -ri "Text" .', 'grep -I "Text" .', 'grep -rI "text" (ohne Pfad/CI)'], correct: 1, explanation: 'r = rekursiv, i = ignore case (case-insensitive).' },
            { type: 'SC', id: 34, category: 'filesystem-cli', categoryName: 'Dateisystem & CLI', question: 'df ist schneller, weil ‚Ä¶', options: ['nur Dateisystem-Metadaten (Superblock) liest', 'nur / scannt', 'nur RAM z√§hlt', 'in C geschrieben ist'], correct: 0, explanation: 'df liest nur den Superblock, der die Dateisystem-Statistiken enth√§lt. Im Gegensatz zu du muss es nicht alle einzelnen Dateien durchgehen.' },
            { type: 'SC', id: 35, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'journalctl -u ssh.service -f macht ‚Ä¶', options: ['Boot-Logs zeigen', 'Live-Follow nur f√ºr SSH-Service', 'alle Logs durchsuchen', 'Units neu laden'], correct: 1, explanation: '-u filtert nach der Unit (Dienst), -f (follow) zeigt neue Logs in Echtzeit an.' },
            { type: 'MC', id: 36, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'Services steuern ‚Äì korrekt:', options: ['systemctl restart ssh', 'systemctl enable ssh', 'systemctl reload ssh', 'service sshd start ist verpflichtend', 'systemctl status ssh.service'], correct: [0, 1, 2, 4], explanation: 'service ist veraltet (oder nur ein Wrapper f√ºr systemctl), systemctl ist das Standard-Tool zum Verwalten von Diensten.' },
            { type: 'SC', id: 37, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'PXE bedeutet ‚Ä¶', options: ['Boot von Disk-Image per USB', 'Boot √ºber Netzwerk (Preboot Execution Environment)', 'Nur f√ºr UEFI g√ºltig', 'Nur f√ºr Container'], correct: 1, explanation: 'PXE (Preboot Execution Environment) erm√∂glicht das Booten √ºber das Netzwerk ohne lokale Speichermedien.' },
            { type: 'SC', id: 38, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'shutdown -r now ‚Ä¶', options: ['Hibernate', 'Sofortiger Neustart', 'Neustart in 1 Minute', 'Herunterfahren ohne Netz'], correct: 1, explanation: '-r steht f√ºr reboot, now f√ºr sofort.' },
            { type: 'MC', id: 39, category: 'filesystem-cli', categoryName: 'Dateisystem & CLI', question: 'Troubleshooting Netzwerk:', options: ['ip a ‚Äì Interfaces/IPs', 'hostname -I ‚Äì nur IP-Adressen', 'ping -c 4 8.8.8.8 ‚Äì reines Routing/ICMP', 'ping -c 4 google.com ‚Äì inkl. DNS-Pfad', 'df -h ‚Äì √ºberpr√ºft Sockets'], correct: [0, 1, 2, 3], explanation: 'df -h pr√ºft Festplattenspeicher, nicht Sockets. Alle anderen sind korrekte Netzwerk-Troubleshooting-Befehle.' },
            { type: 'SC', id: 40, category: 'user-rights', categoryName: 'User-Rechte & Links', question: 'chmod 755 script.sh ergibt ‚Ä¶', options: ['rwxr-xr-x', 'rw-r--r--', 'rwxrwxrwx', 'rwxr-x---'], correct: 0, explanation: '7=rwx (Owner), 5=r-x (Gruppe), 5=r-x (Andere).' },
            { type: 'SC', id: 41, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'Zombie-Prozess ist ‚Ä¶', options: ['beendeter Prozess, noch im Prozessbaum (nicht ‚Äûgereapt‚Äú)', 'uninterruptible sleep', 'gestoppter Prozess', 'Kernel-Thread'], correct: 0, explanation: 'Ein Zombie-Prozess hat seine Ausf√ºhrung beendet, aber sein Eintrag im Prozessbaum wurde noch nicht vom Elternprozess entfernt (gereapt).' },
            { type: 'SC', id: 42, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'kill -9 <PID> soll ‚Ä¶', options: ['immer als Erstes kommen', 'nur wenn SIGTERM nicht hilft', 'nur als root', 'niemals auf Servern'], correct: 1, explanation: 'SIGKILL (-9) erzwingt das sofortige Beenden ohne die M√∂glichkeit zur Bereinigung. Es sollte nur verwendet werden, wenn SIGTERM (-15) fehlschl√§gt.' },
            { type: 'SC', id: 43, category: 'os-kernel', categoryName: 'OS: Kernel & Abstraktion', question: 'pstree -p zeigt ‚Ä¶', options: ['Dateirechte', 'Prozessbaum mit PIDs', 'Kernel-Module', 'Targets'], correct: 1, explanation: 'pstree zeigt die Prozesse hierarchisch (als Baum), -p f√ºgt die PIDs hinzu.' },
            { type: 'SC', id: 44, category: 'boot-systemd', categoryName: 'Boot & systemd', question: 'systemd-timesyncd konfiguriert man in ‚Ä¶', options: ['/etc/systemd/timesyncd.conf', '/etc/ntp.conf', '/etc/default/timesync', '/var/lib/systemd/timesyncd'], correct: 0, explanation: 'Die Konfigurationen f√ºr systemd-Dienste liegen typischerweise unter /etc/systemd.' },
            { type: 'MC', id: 45, category: 'cloud-basics', categoryName: 'Cloud & Switch Engines', question: 'Switch Engines ‚Äì Praxis (aus deinen Notizen):', options: ['Instanzen im Internet werden sofort angegriffen ‚Üí restriktive SGs', 'Floating IP zwingend f√ºr externen Zugriff', 'Volumes √ºberleben VM-L√∂schung automatisch in jedem Fall', 'Privaten SSH-Key nie hochladen', 'SSH-Key-Pair statt Passwort'], correct: [0, 1, 3, 4], explanation: 'C ist falsch: Man muss "Delete Volume on Instance Delete" explizit auf "No" setzen, damit das Volume √ºberlebt. Floating IP ist zwingend f√ºr externen Zugriff.' },
            
            // TEIL B - Richtig/Falsch (RF)
            { type: 'RF', id: 46, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) apt full-upgrade ist Synonym zu apt dist-upgrade.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Richtig. apt full-upgrade ist der modernere, empfohlene Alias f√ºr apt dist-upgrade.' },
            { type: 'RF', id: 47, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) ls -la zeigt auch versteckte Dateien.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Richtig. -a bedeutet "all", es werden auch Dateien mit einem Punkt (.) am Anfang angezeigt.' },
            { type: 'RF', id: 48, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) df sagt dir, welche Unterordner am meisten Platz brauchen.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Falsch. df zeigt den belegten Platz *pro Dateisystem*. du zeigt den Platz *pro Verzeichnis/Datei* an.' },
            { type: 'RF', id: 49, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) systemctl set-default graphical.target setzt GUI als Standard.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Richtig. set-default √§ndert das symbolische Link f√ºr das Standard-Target, das beim Booten verwendet wird.' },
            { type: 'RF', id: 50, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) modprobe ist √§lter und l√§dt keine Abh√§ngigkeiten.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Falsch. modprobe ist neuer und kann Abh√§ngigkeiten aufl√∂sen. insmod ist √§lter und kann das nicht.' },
            { type: 'RF', id: 51, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) multi-user.target entspricht Runlevel 3.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Richtig. multi-user.target ist der Ersatz f√ºr Runlevel 3 (Multi-User-Modus ohne GUI).' },
            { type: 'RF', id: 52, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) Sticky-Bit verhindert, dass Nicht-Besitzer in einem gemeinsamen Verzeichnis Dateien anderer l√∂schen.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Richtig. Das Sticky-Bit (1xxx) stellt sicher, dass nur der Eigent√ºmer oder Root Dateien l√∂schen k√∂nnen, auch wenn Schreibrechte f√ºr alle vorhanden sind.' },
            { type: 'RF', id: 53, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) uname -r zeigt die Kernel-Version.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Richtig. -r steht f√ºr "kernel-release".' },
            { type: 'RF', id: 54, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) journalctl -b zeigt Logs seit letztem Boot.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Richtig. -b steht f√ºr "boot".' },
            { type: 'RF', id: 55, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: '(R/F) chmod 600 ~/.ssh/id_rsa ist f√ºr SSH verpflichtend.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Richtig. SSH ist sehr strikt bei den Rechten des privaten Schl√ºssels.' },

            // TEIL C - L√ºckentext (FTB)
            { type: 'FTB', id: 56, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'Boot-Kette: (1) _______ ‚Üí Bootloader ‚Üí (2) _______(+initramfs) ‚Üí (3) _______ (PID 1).', correct: ['Firmware/BIOS/UEFI', 'Kernel', 'systemd'], placeholder: ['(1) Firmware-Typ', '(2) Komponente', '(3) Init-System'], explanation: 'Die Kette ist: Firmware/BIOS/UEFI ‚Üí Bootloader (z.B. GRUB) ‚Üí Kernel (+initramfs) ‚Üí systemd (PID 1).' },
            { type: 'FTB', id: 57, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'df -h zeigt freien Speicher pro (1) _______, du -h die Nutzung pro (2) _______.', correct: ['Dateisystem', 'Datei/Verzeichnis'], placeholder: ['(1) Einheit', '(2) Einheit'], explanation: 'df (Disk Free) zeigt Dateisystem-Statistiken (vom Superblock), du (Disk Usage) muss alle Dateien/Verzeichnisse durchz√§hlen.' },
            { type: 'FTB', id: 58, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'systemd arbeitet mit (1) _______ (anstatt Runlevels).', correct: ['Targets'], placeholder: ['(1) systemd-Konzept'], explanation: 'Targets ersetzen die numerischen Runlevels (0-6) von SysVinit.' },
            { type: 'FTB', id: 59, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'SUID entspricht dem Oktal-Pr√§fix (1) _______, SGID (2) _______, Sticky (3) _______.', correct: ['4xxx', '2xxx', '1xxx'], placeholder: ['(1) SUID', '(2) SGID', '(3) Sticky'], explanation: 'Die Oktal-Pr√§fixe sind: SUID=4, SGID=2, Sticky=1. Zusammen mit den Standardrechten ergeben sich dann z.B. 4755.' },
            { type: 'FTB', id: 60, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'Der Befehl zum Aktivieren von NTP via systemd lautet: timedatectl (1) _______ (2) _______.', correct: ['set-ntp', 'true'], placeholder: ['(1) Befehlsteil', '(2) Wert'], explanation: 'Der Befehl ist timedatectl set-ntp true.' },
            { type: 'FTB', id: 61, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'find /var -type f -size +100M findet (1) _______ Dateien gr√∂√üer als (2) _______.', correct: ['regul√§re', '100 MB'], placeholder: ['(1) Dateityp', '(2) Dateigr√∂√üe'], explanation: '-type f sucht nach regul√§ren Dateien, +100M nach Dateien > 100 Megabyte.' },
            { type: 'FTB', id: 62, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'Inodes enthalten nicht den (1) _______.', correct: ['Dateinamen'], placeholder: ['(1) Fehlendes Metadatum'], explanation: 'Der Dateiname ist in den Verzeichniseintr√§gen gespeichert, nicht in der Inode.' },
            { type: 'FTB', id: 63, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'journalctl -u ssh.service -f zeigt die (1) _______-Logs des SSH-Dienstes in (2) _______.', correct: ['Service', 'Echtzeit/Live'], placeholder: ['(1) Typ', '(2) Modus'], explanation: '-u filtert nach der Service-Unit, -f (follow) zeigt die Logs in Echtzeit/Live.' },
            { type: 'FTB', id: 64, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'In Switch Engines ist die Default-Policy der Security Groups: (1) _______.', correct: ['alles blockiert'], placeholder: ['(1) Default-Regel'], explanation: 'Security by Default: Eingehender Traffic ist standardm√§√üig alles blockiert.' },
            { type: 'FTB', id: 65, category: 'mixed', categoryName: 'Richtig/Falsch & L√ºckentext', question: 'systemd-analyze (1) _______ > boot.svg erstellt eine grafische Boot-Darstellung.', correct: ['plot'], placeholder: ['(1) Befehl'], explanation: 'systemd-analyze plot erstellt eine SVG-Datei (grafische Zeitachse) der Boot-Dauer.' },
        ];

        let currentQuestionIndex = 0;
        let userAnswers = {}; // Speichert die Antworten des Benutzers
        let filteredQuestions = []; // Speichert die aktuell gefilterten Fragen
        let currentCategory = 'all';

        // Hilfsfunktion zum Mischen eines Arrays
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Bereitet die Fragen f√ºr die Anzeige vor (initial und nach Kategoriewechsel)
        function initializeQuiz(category) {
            currentCategory = category;
            if (category === 'all') {
                filteredQuestions = questionsData.slice();
            } else {
                filteredQuestions = questionsData.filter(q => q.category === category);
            }
            // Optional: Fragen mischen, wenn alle Fragen ausgew√§hlt sind.
            // shuffleArray(filteredQuestions);
            
            // Setze den Index auf 0 zur√ºck, falls die aktuelle Frage in der neuen Kategorie nicht existiert
            if (currentQuestionIndex >= filteredQuestions.length) {
                currentQuestionIndex = 0;
            }
            if (filteredQuestions.length === 0) {
                document.getElementById('quizContainer').innerHTML = '<p style="text-align: center; margin-top: 50px; font-size: 1.2em;">Keine Fragen in dieser Kategorie.</p>';
                document.getElementById('prevBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('finishBtn').style.display = 'none';
                document.getElementById('checkAnswerBtn').style.display = 'none';
                updateProgress();
                return;
            }

            renderQuestion();
            updateProgress();
            updateNavigationButtons();
        }

        // Aktualisiert die Anzeige des Fortschritts
        function updateProgress() {
            const totalQuestions = filteredQuestions.length;
            const answeredQuestions = Object.keys(userAnswers).filter(id => {
                const q = questionsData.find(qd => qd.id == id);
                return q && (q.category === currentCategory || currentCategory === 'all') && userAnswers[id] !== undefined;
            }).length;

            const correctCount = Object.values(userAnswers).filter(a => a.isCorrect).length;
            const wrongCount = Object.values(userAnswers).filter(a => a.isAnswered && !a.isCorrect).length;
            const successRate = answeredQuestions > 0 ? ((correctCount / answeredQuestions) * 100).toFixed(0) : 0;
            const progress = (answeredQuestions / totalQuestions) * 100 || 0;

            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressFill').textContent = `${progress.toFixed(0)}%`;
            document.getElementById('progressText').textContent = `${answeredQuestions}/${totalQuestions}`;
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            document.getElementById('successRate').textContent = `${successRate}%`;

            if (answeredQuestions === totalQuestions && totalQuestions > 0) {
                document.getElementById('finishBtn').style.display = 'inline-block';
            } else {
                document.getElementById('finishBtn').style.display = 'none';
            }
        }

        // Rendert die aktuelle Frage
        function renderQuestion() {
            const questionContainer = document.getElementById('quizContainer');
            if (filteredQuestions.length === 0) return;

            const question = filteredQuestions[currentQuestionIndex];
            const isAnswered = userAnswers[question.id] && userAnswers[question.id].isAnswered;
            const currentAnswer = userAnswers[question.id] ? userAnswers[question.id].selection : null;

            let optionsHtml = '';
            
            // SC, MC und R/F Fragen
            if (question.type === 'SC' || question.type === 'MC' || question.type === 'RF') {
                optionsHtml = question.options.map((option, index) => {
                    const isSelected = Array.isArray(currentAnswer) ? currentAnswer.includes(index) : currentAnswer === index;
                    const isCorrect = isAnswered && (Array.isArray(question.correct) ? question.correct.includes(index) : question.correct === index);
                    const isWrongSelection = isSelected && isAnswered && !isCorrect;
                    const optionClass = isSelected ? 'selected' : '';
                    const resultClass = isAnswered ? (isCorrect ? 'correct' : (isWrongSelection ? 'wrong' : '')) : '';
                    
                    let letter = String.fromCharCode(65 + index); // A, B, C, D...

                    return `
                        <div class="option ${optionClass} ${resultClass}" data-index="${index}" data-correct="${isCorrect}">
                            <div class="option-letter">${letter}</div>
                            <span>${option}</span>
                            ${question.type === 'MC' && !isAnswered ? `<input type="checkbox" class="option-checkbox" ${isSelected ? 'checked' : ''} />` : ''}
                            ${isAnswered && question.type === 'MC' && isCorrect ? '‚úÖ' : ''}
                            ${isAnswered && question.type === 'MC' && isWrongSelection ? '‚ùå' : ''}
                        </div>
                    `;
                }).join('');

            // L√ºckentext Fragen
            } else if (question.type === 'FTB') {
                optionsHtml = '<div class="fill-in-the-blank-container">';
                const numBlanks = question.correct.length;
                for (let i = 0; i < numBlanks; i++) {
                    const value = currentAnswer && currentAnswer[i] !== undefined ? currentAnswer[i] : '';
                    const placeholder = question.placeholder ? question.placeholder[i] : `L√ºcke ${i + 1}`;
                    let inputClass = 'fill-in-the-blank-input';
                    
                    if (isAnswered) {
                        const isBlankCorrect = userAnswers[question.id].correctBlanks[i];
                        inputClass += isBlankCorrect ? ' correct-answer' : ' wrong-answer';
                    }

                    optionsHtml += `
                        <div class="fill-in-the-blank-wrapper">
                            <label for="ftb-${i}" class="fill-in-the-blank-label">${placeholder}:</label>
                            <input type="text" id="ftb-${i}" data-index="${i}" class="${inputClass}" value="${value}" ${isAnswered ? 'disabled' : ''}>
                        </div>
                    `;
                }
                optionsHtml += '</div>';
            }

            // Gesamtes Question Card HTML
            questionContainer.innerHTML = `
                <div class="question-card fade-in" id="q-${question.id}">
                    <div class="question-header">
                        <div class="question-number">Frage ${currentQuestionIndex + 1} von ${filteredQuestions.length}</div>
                        <div class="category-tag">${question.categoryName} (${question.type})</div>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="options ${question.type === 'MC' ? 'multiple-choice' : ''}">${optionsHtml}</div>
                    <div class="answer-section ${isAnswered ? 'show' : 'hide'}" id="answer-q-${question.id}">
                        <div class="answer-header">L√∂sung:</div>
                        <div class="answer-text">
                            ${getAnswerExplanation(question, userAnswers[question.id])}
                            ${question.explanation ? `<p style="margin-top: 10px; font-style: italic;">Erkl√§rung: ${question.explanation}</p>` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            // Event Listener f√ºr Auswahlfragen (SC/MC/RF)
            if (question.type === 'SC' || question.type === 'MC' || question.type === 'RF') {
                document.querySelectorAll('.option').forEach(optionElement => {
                    if (!isAnswered) { // Nur klickbar, wenn noch nicht beantwortet
                        optionElement.addEventListener('click', () => handleOptionClick(question, optionElement));
                    }
                });
            }

            updateNavigationButtons();
            
            // Check-Answer Button Logik
            document.getElementById('checkAnswerBtn').onclick = () => checkAnswer(question);
            document.getElementById('checkAnswerBtn').style.display = isAnswered ? 'none' : 'inline-block';
        }

        // Generiert die Erkl√§rung/L√∂sung f√ºr die Antwortsektion
        function getAnswerExplanation(question, userAnswer) {
            if (question.type === 'SC' || question.type === 'MC' || question.type === 'RF') {
                let correctOptions = Array.isArray(question.correct) ? question.correct : [question.correct];
                let correctLetters = correctOptions.map(i => String.fromCharCode(65 + i)).join(', ');
                let userLetters = Array.isArray(userAnswer.selection) ? userAnswer.selection.map(i => String.fromCharCode(65 + i)).join(', ') : (userAnswer.selection !== null ? String.fromCharCode(65 + userAnswer.selection + 65) : 'N/A');

                let status = userAnswer.isCorrect ? '<span style="color: #28a745; font-weight: bold;">RICHTIG!</span>' : '<span style="color: #dc3545; font-weight: bold;">FALSCH.</span>';

                return `
                    <p>Status: ${status}</p>
                    <p>Ihre Auswahl: ${userAnswer.selection === null ? 'Keine Auswahl' : userLetters}</p>
                    <p>Korrekte Option(en): ${correctLetters} (${correctOptions.map(i => question.options[i]).join('; ')})</p>
                `;
            } else if (question.type === 'FTB') {
                let html = userAnswer.isCorrect ? '<p style="color: #28a745; font-weight: bold;">RICHTIG!</p>' : '<p style="color: #dc3545; font-weight: bold;">FALSCH.</p>';
                html += '<table><thead><tr><th>L√ºcke</th><th>Ihre Antwort</th><th>Korrekte Antwort</th></tr></thead><tbody>';

                for (let i = 0; i < question.correct.length; i++) {
                    const userVal = userAnswer.selection[i] || '';
                    const correctVal = Array.isArray(question.correct[i]) ? question.correct[i].join(' ODER ') : question.correct[i];
                    const statusIcon = userAnswer.correctBlanks[i] ? '‚úÖ' : '‚ùå';
                    const placeholderText = question.placeholder ? question.placeholder[i] : `L√ºcke ${i+1}`;
                    html += `<tr><td>${placeholderText}</td><td>${statusIcon} ${userVal}</td><td>${correctVal}</td></tr>`;
                }
                html += '</tbody></table>';
                return html;
            }
        }


        // Behandelt Klicks auf Optionen (Auswahlfragen)
        function handleOptionClick(question, optionElement) {
            const index = parseInt(optionElement.getAttribute('data-index'));
            const options = document.querySelectorAll('.option');
            let currentSelection = userAnswers[question.id] && userAnswers[question.id].selection ? userAnswers[question.id].selection : (question.type === 'MC' ? [] : null);
            
            // Wenn es eine Single Choice (SC/RF) ist, entferne alle Selektionen
            if (question.type === 'SC' || question.type === 'RF') {
                options.forEach(opt => opt.classList.remove('selected'));
                currentSelection = index;
                optionElement.classList.add('selected');
            } 
            // Wenn es eine Multiple Choice (MC) ist
            else if (question.type === 'MC') {
                if (optionElement.classList.contains('selected')) {
                    optionElement.classList.remove('selected');
                    const idxToRemove = currentSelection.indexOf(index);
                    if (idxToRemove > -1) {
                        currentSelection.splice(idxToRemove, 1);
                    }
                } else {
                    optionElement.classList.add('selected');
                    currentSelection.push(index);
                }
            }

            // Speichere die aktuelle Auswahl VOR der finalen √úberpr√ºfung
            userAnswers[question.id] = { selection: currentSelection, isAnswered: false, isCorrect: false };
            updateProgress();
        }

        // √úberpr√ºft die Antwort
        function checkAnswer(question) {
            if (userAnswers[question.id] && userAnswers[question.id].isAnswered) return; // Schon beantwortet
            
            let isCorrect = false;
            let currentSelection = null;
            let correctBlanks = [];

            // SC/MC/RF
            if (question.type === 'SC' || question.type === 'MC' || question.type === 'RF') {
                const selectedOptions = Array.from(document.querySelectorAll('.option.selected')).map(el => parseInt(el.getAttribute('data-index')));
                currentSelection = question.type === 'SC' || question.type === 'RF' ? (selectedOptions.length > 0 ? selectedOptions[0] : null) : selectedOptions;

                if (question.type === 'SC' || question.type === 'RF') {
                    isCorrect = currentSelection === question.correct;
                } else { // MC
                    const correctAnswers = question.correct;
                    // √úberpr√ºfung: Hat der Nutzer genau die richtigen Antworten gew√§hlt?
                    isCorrect = selectedOptions.length === correctAnswers.length && 
                                selectedOptions.every(val => correctAnswers.includes(val));
                }
            } 
            // FTB
            else if (question.type === 'FTB') {
                const inputs = Array.from(document.querySelectorAll('.fill-in-the-blank-input'));
                currentSelection = inputs.map(input => input.value.trim());

                let allBlanksCorrect = true;
                correctBlanks = currentSelection.map((userAnswer, index) => {
                    const correctAnswers = Array.isArray(question.correct[index]) ? question.correct[index] : [question.correct[index]];
                    const match = correctAnswers.some(correctAnswer => userAnswer.toLowerCase() === correctAnswer.toLowerCase());
                    if (!match) allBlanksCorrect = false;
                    return match;
                });
                isCorrect = allBlanksCorrect;
            }


            // Speichere das Ergebnis
            userAnswers[question.id] = {
                selection: currentSelection,
                isAnswered: true,
                isCorrect: isCorrect,
                correctBlanks: correctBlanks // Nur f√ºr FTB relevant
            };

            // Re-render, um die L√∂sung anzuzeigen
            renderQuestion();
            updateProgress();
        }

        // Aktualisiert die Anzeige der Navigationsbuttons
        function updateNavigationButtons() {
            const total = filteredQuestions.length;

            document.getElementById('prevBtn').style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
            document.getElementById('nextBtn').style.display = currentQuestionIndex < total - 1 ? 'inline-block' : 'none';

            // Wenn es die letzte Frage ist und alle Fragen beantwortet sind
            const answeredCount = Object.keys(userAnswers).filter(id => {
                const q = questionsData.find(qd => qd.id == id);
                return q && (q.category === currentCategory || currentCategory === 'all') && userAnswers[id] && userAnswers[id].isAnswered;
            }).length;

            if (currentQuestionIndex === total - 1 && answeredCount === total) {
                 document.getElementById('finishBtn').style.display = 'inline-block';
                 document.getElementById('nextBtn').style.display = 'none';
            } else if (currentQuestionIndex === total - 1 && answeredCount < total) {
                // Letzte Frage, noch nicht alle beantwortet
                document.getElementById('finishBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').style.display = 'none';
            } else {
                document.getElementById('finishBtn').style.display = 'none';
            }
        }

        // Navigations-Logik
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        });

        document.getElementById('finishBtn').addEventListener('click', () => {
            // Zeige die Zusammenfassung
            showResults();
        });


        // Rendert die Ergebnis√ºbersicht
        function showResults() {
            const totalQuestions = filteredQuestions.length;
            const correctCount = Object.keys(userAnswers).filter(id => {
                const q = questionsData.find(qd => qd.id == id);
                return q && (q.category === currentCategory || currentCategory === 'all') && userAnswers[id] && userAnswers[id].isCorrect;
            }).length;
            
            const answeredCount = Object.keys(userAnswers).filter(id => {
                const q = questionsData.find(qd => qd.id == id);
                return q && (q.category === currentCategory || currentCategory === 'all') && userAnswers[id] && userAnswers[id].isAnswered;
            }).length;

            const score = (correctCount / totalQuestions) * 100;
            const passed = score >= 50; // Einfache 50%-Regel

            document.querySelector('.quiz-content').innerHTML = `
                <div class="result-summary fade-in">
                    <h2>${passed ? 'Gl√ºckwunsch! Bestanden! üéâ' : 'Weiter √úben... üò•'}</h2>
                    <p>Sie haben das Quiz in der Kategorie <strong>"${document.querySelector('.category-btn.active').textContent}"</strong> abgeschlossen.</p>
                    <div class="result-score">${correctCount}/${totalQuestions}</div>
                    <p>Erfolgsrate: <strong>${score.toFixed(0)}%</strong></p>

                    <div class="result-details">
                        <div class="result-detail">
                            <div class="stat-label">Gesamtzahl Fragen</div>
                            <div class="result-detail-value">${totalQuestions}</div>
                        </div>
                        <div class="result-detail">
                            <div class="stat-label">Beantwortet</div>
                            <div class="result-detail-value">${answeredCount}</div>
                        </div>
                        <div class="result-detail">
                            <div class="stat-label">Richtig</div>
                            <div class="result-detail-value" style="color: #28a745;">${correctCount}</div>
                        </div>
                        <div class="result-detail">
                            <div class="stat-label">Falsch</div>
                            <div class="result-detail-value" style="color: #dc3545;">${answeredCount - correctCount}</div>
                        </div>
                    </div>

                    <div class="button-group" style="margin-top: 40px;">
                        <button class="btn btn-primary" onclick="window.location.reload();">Neues Quiz starten</button>
                        <button class="btn btn-secondary" onclick="reviewAnswers();">Antworten einsehen</button>
                    </div>
                </div>
            `;
            document.querySelector('.button-group').style.display = 'none'; // Verstecke die alten Nav-Buttons
        }

        // Logik zum Einsehen der Antworten nach Abschluss des Quiz (optional)
        function reviewAnswers() {
            // Setze den Index zur√ºck und re-initialisiere, um alle Fragen anzuzeigen
            currentQuestionIndex = 0;
            initializeQuiz(currentCategory);
            document.getElementById('checkAnswerBtn').style.display = 'none'; // Verstecke den Check-Button
            document.getElementById('finishBtn').style.display = 'none';
        }
        
        // Dynamische Generierung der Kategorien-Buttons
        function setupCategories() {
            const categories = questionsData.reduce((acc, q) => {
                acc[q.category] = (acc[q.category] || 0) + 1;
                return acc;
            }, {});

            const categorySelector = document.getElementById('categorySelector');
            let html = `<button class="category-btn active" data-category="all">Alle Fragen (${questionsData.length})</button>`;
            
            // Definiere sichtbare Namen f√ºr die Kategorien
            const categoryNames = {
                'os-kernel': 'OS: Kernel/Abstraktion (7)',
                'paket-management': 'Paket-Management (3)',
                'filesystem-cli': 'Dateisystem/CLI (6)',
                'ssh-security': 'SSH/Sicherheit (1)',
                'cloud-basics': 'Cloud/SE Basics (5)',
                'boot-systemd': 'Boot/systemd (8)',
                'user-rights': 'User-Rechte/Links (4)',
                'mixed': 'Bonus (20) R/F & L√ºckentext' 
            };
            
            // Filtere die Hauptkategorien, um die Reihenfolge beizubehalten
            const orderedCategories = [
                'os-kernel', 'paket-management', 'filesystem-cli', 
                'ssh-security', 'cloud-basics', 'boot-systemd', 'user-rights', 'mixed'
            ];

            orderedCategories.forEach(cat => {
                if (categories[cat]) {
                    const name = categoryNames[cat] || cat;
                    html += `<button class="category-btn" data-category="${cat}">${name}</button>`;
                }
            });

            categorySelector.innerHTML = html;

            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentQuestionIndex = 0; // Setze den Index beim Wechsel zur√ºck
                    userAnswers = {}; // Setze Antworten zur√ºck beim Kategoriewechsel
                    initializeQuiz(e.target.getAttribute('data-category'));
                });
            });
        }


        // Startet das Quiz beim Laden der Seite
        document.addEventListener('DOMContentLoaded', () => {
            setupCategories();
            initializeQuiz('all');
        });

    </script>
</body>
</html>
